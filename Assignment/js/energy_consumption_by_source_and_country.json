{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Ranking of countries over time for selected energy source",
  "description": "Bump chart showing ranking of countries over time for selected energy source, colored by continent, with dots for each year and hover interaction.",
  "height": 250,
  "width": "container",
  "data": {
    "url": "https://raw.githubusercontent.com/JDan0036/FIT3179_homeword/refs/heads/main/Assignment/Dataset/energy_consumption.csv",
    "format": {
      "type": "csv"
    }
  },
  "params": [
    {
      "name": "energy_selection",
      "value": "Biofuels consumption - TWh Rank",
      "bind": {
        "input": "select",
        "options": [
          "Biofuels consumption - TWh Rank",
          "Solar consumption - TWh Rank",
          "Wind consumption - TWh Rank",
          "Hydro consumption - TWh Rank",
          "Nuclear consumption - TWh Rank",
          "Gas consumption - TWh Rank",
          "Coal consumption - TWh Rank",
          "Oil consumption - TWh Rank"
        ],
        "labels": [
          "Biofuels",
          "Solar",
          "Wind",
          "Hydro",
          "Nuclear",
          "Gas",
          "Coal",
          "Oil"
        ],
        "name": "Select Energy Source: "
      }
    },
    {
      "name": "Top_Ranks",
      "value": 5,
      "bind": {
        "name": "Top Ranks",
        "input": "range",
        "min": 3,
        "max": 15,
        "step": 1
      }
    }
  ],
  "transform": [
    {
      "fold": [
        "Biofuels consumption - TWh Rank",
        "Solar consumption - TWh Rank",
        "Wind consumption - TWh Rank",
        "Hydro consumption - TWh Rank",
        "Nuclear consumption - TWh Rank",
        "Gas consumption - TWh Rank",
        "Coal consumption - TWh Rank",
        "Oil consumption - TWh Rank"
      ],
      "as": ["Energy Source", "Rank"]
    },
    {
      "filter": "datum['Energy Source'] == energy_selection"
    },
    {
      "filter": "datum['Rank'] <= Top_Ranks && datum['Rank'] > 0"
    },
    {
      "filter": "datum['Continent'] != '0' && datum['Continent'] != null"
    },
    {
      "calculate": "replace(datum['Energy Source'], ' - TWh Rank', '')",
      "as": "Energy Source Clean"
    }
  ],
  "layer": [
    {
      "mark": "line",
      "selection": {
        "highlight": {
          "type": "single",
          "on": "mouseover",
          "empty": "none",
          "fields": ["Entity"]
        }
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "temporal",
          "axis": {
            "title": "Year"
          }
        },
        "y": {
          "field": "Rank",
          "type": "quantitative",
          "scale": {"reverse": true}, 
          "axis": {
            "title": "Rank"
          }
        },
        "color": {
          "field": "Continent",
          "type": "nominal",
          "legend": {
            "title": {"expr": "energy_selection.replace(' consumption - TWh Rank', '')"}
          },
          "condition": {
            "param": "highlight",
            "empty": false,
            "value": "black"
          }
        },
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.2
        },
        "detail": {"field": "Entity"}
      }
    },
    {
      "mark": {
        "type": "point",
        "filled": true,
        "size": 60
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "temporal"
        },
        "y": {
          "field": "Rank",
          "type": "quantitative"
        },
        "color": {
          "field": "Continent",
          "type": "nominal",
          "legend": {
            "title": {"expr": "energy_selection.replace(' consumption - TWh Rank', '')"}
          },
          "condition": {
            "param": "highlight",
            "empty": false,
            "value": "black"
          }
        },
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.2
        },
        "detail": {"field": "Entity"},
        "tooltip": [
          {"field": "Entity", "type": "nominal", "title": "Country"},
          {"field": "Year", "type": "temporal", "format": "%Y"},
          {"field": "Rank", "type": "quantitative", "title": "Rank"},
          {"field": "Energy Source Clean", "type": "nominal", "title": "Energy Source"},
          {"field": "Continent", "type": "nominal", "title": "Continent"}
        ]
      }
    }
  ],
  "config": {
    "style": {"cell": {"stroke": "transparent"}}
  }
}
